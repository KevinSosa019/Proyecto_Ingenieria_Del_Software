<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Cliente - PokerTech</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">

</head>
<body class="bg-gray-100 min-h-screen">

<!-- TOP BAR -->
<header class="bg-blue-800 text-white">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">

        <div class="flex items-center gap-4">
            <h1 class="text-xl font-semibold">PokerTech</h1>
            <span class="ml-2 px-2 py-1 bg-blue-700 rounded-full text-sm">Cliente</span>
        </div>

        <div class="flex items-center gap-4">
            <div class="font-semibold">
                {{ client.first_name }} {{ client.last_name }}
            </div>
        
            <a href="/accounts/logout/"
               class="bg-red-600 px-3 py-1 rounded text-white text-sm hover:bg-red-700">
                Cerrar sesi√≥n
            </a>
        </div>


    </div>
</header>

<!-- MAIN CONTENT -->
<main class="max-w-7xl mx-auto px-6 py-8">

    <!-- Title -->
    <div class="mb-6">
        <h2 class="text-3xl font-bold">Panel del Cliente</h2>
        <p class="text-gray-600">Revisa tus m√°quinas, reporta problemas y consulta tus √≥rdenes activas.</p>
    </div>

    <!-- STATUS BAR (Matches technician layout) -->
    <div class="bg-blue-600 text-white rounded-xl p-6 mb-8 flex justify-between items-center">
        <div>
            <h3 class="text-lg font-semibold">Estado General</h3>
            <p class="mt-1">
                Tienes <strong>{{ machines|length }}</strong> m√°quinas registradas ‚Äî 
                <strong>{{ en_reparacion }}</strong> en reparaci√≥n actualmente.
            </p>
        </div>

        <a href="/dashboard/client/orders/"
           class="bg-white text-blue-700 px-4 py-2 rounded-lg shadow font-semibold">
            üìÑ Ver Mis √ìrdenes
        </a>
    </div>

    <!-- STAT CARDS (Same layout as technician) -->
    <div class="grid grid-cols-4 gap-6 mb-10">

        <!--div class="bg-white rounded-xl p-5 shadow">
            <div class="text-gray-500">Fuera de Servicio</div>
            <div class="text-4xl font-bold mt-2">{{ fuera_servicio }}</div>
            <div class="text-sm text-yellow-600 font-semibold mt-1">Advertencia</div>
        </div-->

        <div class="bg-white rounded-xl p-5 shadow">
            <div class="text-gray-500">En Mantenimiento</div>
            <div class="text-4xl font-bold mt-2">{{ en_mantenimiento }}</div>
            <!--div class="text-sm text-blue-600 font-semibold mt-1">Esperando t√©cnico</div-->
        </div>

        <div class="bg-white rounded-xl p-5 shadow">
            <div class="text-gray-500">En Reparaci√≥n</div>
            <div class="text-4xl font-bold mt-2">{{ en_reparacion }}</div>
            <!--div class="text-sm text-yellow-600 font-semibold mt-1">T√©cnico asignado</div-->
        </div>

        <div class="bg-white rounded-xl p-5 shadow">
            <div class="text-gray-500">Reparadas</div>
            <div class="text-4xl font-bold mt-2">{{ repairs_done }}</div>
            <!--div class="text-sm text-green-600 font-semibold mt-1">Reparada</div-->
        </div>

    </div>

    <!-- Machines Section -->
    <h2 class="text-2xl font-semibold mb-4">Mis M√°quinas</h2>

    {% if machines|length == 0 %}
        <div class="bg-white p-6 rounded-xl shadow text-center text-gray-500">
            No tienes m√°quinas asignadas.
        </div>

    {% else %}
    <div class="grid grid-cols-3 gap-6">

        {% for machine in machines %}
            <div class="bg-white rounded-xl shadow p-6 border hover:shadow-xl transition">

                <!-- Header -->
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">M√°quina #{{ machine.serial }}</h3>

                    <span class="px-3 py-1 text-sm rounded-full font-semibold
                        {% if machine.state == 'Operativa' %}
                            bg-green-100 text-green-700
                        {% elif machine.state == 'En mantenimiento' %}
                            bg-blue-100 text-blue-700
                        {% elif machine.state == 'En reparaci√≥n' %}
                            bg-yellow-100 text-yellow-700
                        {% else %}
                            bg-red-100 text-red-700
                        {% endif %}
                    ">
                        {{ machine.state }}
                    </span>
                </div>

                <p class="text-gray-700"><strong>Modelo:</strong> {{ machine.model }}</p>
                <p class="text-gray-700"><strong>Ubicaci√≥n:</strong> {{ machine.location }}</p>
                <p class="text-gray-700 mb-4"><strong>ID:</strong> {{ machine.id }}</p>

                <div class="flex justify-between mt-4">
                    <button onclick="openReportModal('{{ machine.id }}')"
                            class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600">
                        Reportar Problema
                    </button>

                    <a href="/dashboard/client/order/{{ machine.id }}/"
                       class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">
                        Ver Detalles
                    </a>
                </div>

            </div>
        {% endfor %}
    </div>
    {% endif %}

</main>

<!-- MODAL -->
<div id="reportModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white w-[600px] rounded-xl shadow-xl p-8">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
            <span class="text-red-500 text-xl">üö®</span>
            Reportar Problema con M√°quina
        </h2>

        <form method="POST" action="/dashboard/report/">
            {% csrf_token %}

            <label class="font-semibold">M√°quina</label>
            <select name="maquina_id" required class="border p-2 rounded w-full mb-4">
                {% for m in machines %}
                    <option value="{{ m.id }}">#{{ m.serial }} - {{ m.model }}</option>
                {% endfor %}
            </select>
        
            <label class="font-semibold">Tipo de problema</label>
            <select name="tipo_id" required class="border p-2 rounded w-full mb-4">
                {% for t in problem_types %}
                    <option value="{{ t.id }}">{{ t.name }}</option>
                {% endfor %}
            </select>
        
            <label class="font-semibold">Prioridad</label>
            <select name="prioridad_id" required class="border p-2 rounded w-full mb-4">
                {% for p in priorities %}
                    <option value="{{ p.id }}">{{ p.nombre }}</option>
                {% endfor %}
            </select>
        
            <label class="font-semibold">Descripci√≥n</label>
            <textarea name="descripcion" class="border p-2 rounded w-full h-24 mb-4"
                      placeholder="Describe el problema..." required></textarea>
        
            <label class="font-semibold">Impacto</label>
            <select name="impacto" required class="border p-2 rounded w-full mb-4">
                <option value="Bajo">Bajo</option>
                <option value="Medio">Medio</option>
                <option value="Alto">Alto</option>
            </select>
        
            <label class="font-semibold">Contacto (opcional)</label>
            <input type="text" name="contacto" class="border p-2 rounded w-full mb-4">
            <div class="flex justify-between mt-6">
                <button type="button"
                        onclick="closeReportModal()"
                        class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
                    Cancelar
                </button>

                <button type="submit"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    Reportar
                </button>
            </div>
            
        </form>
    </div>
</div>

<script>
function openReportModal(id) {
    document.getElementById("reportModal").classList.remove("hidden");
    document.getElementById("machineSelect").value = id;
}

function closeReportModal() {
    document.getElementById("reportModal").classList.add("hidden");
}
</script>

</body>
</html>
